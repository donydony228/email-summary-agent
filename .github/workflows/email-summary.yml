name: Daily Email Summary

on:
  schedule:
    # 每天 UTC 00:00 執行（台灣時間 08:00）
    - cron: '0 0 * * *'
  workflow_dispatch:  # 允許手動觸發

jobs:
  trigger-email-summary:
    runs-on: ubuntu-latest

    steps:
    - name: Trigger Render webhook
      env:
        RENDER_WEBHOOK_URL: ${{ secrets.RENDER_WEBHOOK_URL }}
      run: |
        echo "觸發 Email Summary 工作流..."
        response=$(curl -s -w "\n%{http_code}" -X POST "$RENDER_WEBHOOK_URL")
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n-1)

        echo "HTTP Status: $http_code"
        echo "Response: $body"

        if [ "$http_code" -eq 200 ]; then
          echo "✓ Email Summary 工作流已成功觸發"
        else
          echo "✗ 觸發失敗"
          exit 1
        fi
